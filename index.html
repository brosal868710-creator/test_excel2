<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QC Excel Pro - Smart Training</title>
    <style>
        :root {
            --excel-green: #217346;
            --excel-light: #e8f5e9;
            --excel-border: #bbb;
        }

        body {
            font-family: 'Segoe UI', 'Khmer OS Battambang', sans-serif;
            background-color: var(--excel-green);
            color: white;
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* --- Login Screen --- */
        #loginScreen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--excel-green);
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .login-card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            color: #333;
            width: 85%;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .input-name {
            width: 100%;
            padding: 15px;
            margin: 20px 0;
            border-radius: 10px;
            border: 2px solid #ddd;
            font-size: 18px;
            box-sizing: border-box;
            text-align: center;
        }

        .btn-start {
            background: #f1c40f;
            color: #333;
            font-weight: bold;
            font-size: 20px;
            padding: 15px 40px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            width: 100%;
            box-shadow: 0 4px 0 #d35400;
        }

        /* --- Game Screen --- */
        #gameScreen { display: none; width: 100%; max-width: 500px; }

        .excel-window {
            background: white;
            color: #333;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            margin-bottom: 15px;
        }

        .formula-bar {
            background: #f3f3f3;
            padding: 10px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #ddd;
        }

        .fx { font-style: italic; color: #888; font-weight: bold; margin-right: 10px; }

        .formula-input {
            flex: 1;
            padding: 5px;
            border: 1px solid #ccc;
            background: white;
            height: 30px;
            font-family: monospace;
            display: flex;
            align-items: center;
            font-size: 16px;
        }

        .sheet {
            display: grid;
            grid-template-columns: 40px 1fr 1fr;
        }

        .header-cell { background: #e6e6e6; font-weight: bold; text-align: center; border: 1px solid #ccc; padding: 5px; }
        .cell { border: 1px solid #eee; padding: 12px 5px; text-align: center; font-size: 14px; }
        .active-cell { background: var(--excel-light); border: 2px solid #2ecc71 !important; font-weight: bold; }

        .mission {
            background: white;
            color: #333;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .keyboard {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .key {
            padding: 15px 5px;
            border-radius: 8px;
            border: none;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }

        .key-func { background: #3498db; color: white; }
        .key-val { background: #ecf0f1; color: #333; }
        .key-del { background: #e74c3c; color: white; }
        .key-ok { grid-column: span 2; background: #2ecc71; color: white; font-size: 16px; }

        /* --- Result Overlay --- */
        #resultOverlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- 1. Login Screen -->
    <div id="loginScreen">
        <div class="login-card">
            <h1 style="color:var(--excel-green); margin:0;">QC EXCEL PRO</h1>
            <p>áŸá¼á˜áœá¶á™áˆáŸ’á˜áŸ„áŸ‡á”á»á‚áŸ’á‚á›á·á€ áŠá¾á˜áŸ’á”á¸á…á¶á”áŸ‹á•áŸ’áá¾á˜:</p>
            <input type="text" id="staffName" class="input-name" placeholder="áˆáŸ’á˜áŸ„áŸ‡á”á»á‚áŸ’á‚á›á·á€ / å§“å">
            <button class="btn-start" onclick="startTraining()">á…á¼á›ášá½á˜ášáŸ€á“ (Start)</button>
        </div>
    </div>

    <!-- 2. Game Screen -->
    <div id="gameScreen">
        <div style="text-align: center; margin-bottom: 10px; font-weight: bold;">
            ğŸ“Š á€áŸ†á–á»á„á¢á“á»áœááŸ’ááŸ– Level <span id="levelNum">1</span> / 4
        </div>

        <div class="excel-window">
            <div class="formula-bar">
                <span class="fx">fx</span>
                <div class="formula-input" id="formulaDisplay"></div>
            </div>
            <div class="sheet" id="sheetGrid"></div>
        </div>

        <div class="mission">
            <strong style="color:#d35400" id="missionTitle">Mission</strong><br>
            <span id="missionDesc">Loading...</span>
        </div>

        <div class="keyboard" id="keyboard"></div>
    </div>

    <!-- 3. Final Result -->
    <div id="resultOverlay">
        <div style="font-size: 80px;">ğŸ†</div>
        <h2>á€á¶ášá”ááŸ’áá»áŸ‡á”ááŸ’áá¶á›ááŸ’ášá¼áœá”á¶á“á”á‰áŸ’á…á”áŸ‹!</h2>
        <p id="submittingText">á€áŸ†á–á»á„á•áŸ’á‰á¾á›á‘áŸ’á’á•á›á‘áŸ…á€á¶á“áŸ‹á”áŸ’ášá–áŸá“áŸ’á’...</p>
        <button class="btn-start" onclick="location.reload()" style="width: auto;">ááŸ’ášá¡á”áŸ‹á‘áŸ…áŠá¾á˜ (Reset)</button>
    </div>

    <script>
        // ========== âš ï¸ á€á¼áŠá—áŸ’á‡á¶á”áŸ‹ GOOGLE FORM (á”á„á˜á·á“á”á¶á…áŸ‹á€áŸ‚á‘áŸ) âš ï¸ ==========
        const FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSfJE77modSHPySeAh1ZBc0_C9WmIKxCITsP5hHf9i05USAaNQ/formResponse";
        const ID_NAME = "entry.349400734";
        const ID_SCORE = "entry.232980007";
        // =============================================================

        let playerName = "";
        let currentLvl = 0;
        let userInput = "";

        const levels = [
            { name: "1. LEFT (á€á¶ááŸ‹á†áŸ’áœáŸá„)", desc: "á€á¶ááŸ‹á™á€á¢á€áŸ’áŸáš 'XDS' á…áŸá‰á–á¸á€á¼áŠáŸ”\nášá¼á”á˜á“áŸ’ááŸ– =LEFT(A2, 3)", data: "XDS-2026", ans: "=LEFT(A2,3)", res: "XDS", keys: ["=LEFT(", "A2", ",", "3", ")", '"XDS"'] },
            { name: "2. CONCAT (&)", desc: "á•áŸ’á‚á»áŸ†á–á¶á€áŸ’á™ '20' á‡á¶á˜á½á™á†áŸ’á“á¶áŸ† '26'áŸ”\nášá¼á”á˜á“áŸ’ááŸ– ='20' & A2", data: "26", ans: '="20"&A2', res: "2026", keys: ['="20"', "&", "A2", "20", '"20"', "+"] },
            { name: "3. LEN (ášá¶á”áŸ‹á¢á€áŸ’áŸáš)", desc: "áá¾á–á¶á€áŸ’á™ 'China' á˜á¶á“á”áŸ‰á»á“áŸ’á˜á¶á“á¢á€áŸ’áŸáš?\nášá¼á”á˜á“áŸ’ááŸ– =LEN(A2)", data: "China", ans: "=LEN(A2)", res: "5", keys: ["=LEN(", "A2", ")", "5", "6", "A1"] },
            { name: "4. TRIM (á›á»á” Space)", desc: "á›á»á” Space áŠáŸ‚á›á›á¾áŸá“áŸ…áá¶á„á˜á»áá…áŸá‰áŸ”\nášá¼á”á˜á“áŸ’ááŸ– =TRIM(A2)", data: "  QC", ans: "=TRIM(A2)", res: "QC", keys: ["=TRIM(", "A2", ")", "  ", "CUT", "SPACE"] }
        ];

        function startTraining() {
            playerName = document.getElementById('staffName').value.trim();
            if (playerName === "") { alert("áŸá¼á˜á”á‰áŸ’á…á¼á›áˆáŸ’á˜áŸ„áŸ‡á‡á¶á˜á»á“áŸá·á“!"); return; }
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('gameScreen').style.display = 'block';
            loadLevel();
        }

        function loadLevel() {
            if (currentLvl >= levels.length) {
                finishGame();
                return;
            }

            const lvl = levels[currentLvl];
            userInput = "";
            document.getElementById('formulaDisplay').innerText = "";
            document.getElementById('levelNum').innerText = currentLvl + 1;
            document.getElementById('missionTitle').innerText = lvl.name;
            document.getElementById('missionDesc').innerText = lvl.desc;

            // Build Grid
            document.getElementById('sheetGrid').innerHTML = `
                <div class="header-cell"></div><div class="header-cell">A</div><div class="header-cell">B</div>
                <div class="header-cell">1</div><div class="cell" style="font-weight:bold">Data</div><div class="cell" style="font-weight:bold">Result</div>
                <div class="header-cell">2</div><div class="cell">${lvl.data}</div><div class="cell active-cell" id="activeCell">?</div>
            `;

            // Build Keyboard
            const kb = document.getElementById('keyboard');
            kb.innerHTML = '';
            [...lvl.keys].sort(() => Math.random() - 0.5).forEach(k => {
                const b = document.createElement('button');
                b.className = 'key ' + (k.startsWith('=') ? 'key-func' : 'key-val');
                b.innerText = k;
                b.onclick = () => { userInput += k; updateUI(); };
                kb.appendChild(b);
            });

            // Control Keys
            const del = document.createElement('button'); del.className='key key-del'; del.innerText='âŒ«'; del.onclick=clearInput;
            const ok = document.createElement('button'); ok.className='key key-ok'; ok.innerText='âœ… ENTER'; ok.onclick=checkAnswer;
            kb.appendChild(del); kb.appendChild(ok);
        }

        function updateUI() {
            document.getElementById('formulaDisplay').innerText = userInput;
            document.getElementById('activeCell').innerText = userInput;
        }

        function clearInput() {
            userInput = "";
            updateUI();
            document.getElementById('activeCell').innerText = "?";
        }

        function checkAnswer() {
            const lvl = levels[currentLvl];
            const cleanUser = userInput.replace(/\s/g, '').toUpperCase();
            const cleanAns = lvl.ans.replace(/\s/g, '').toUpperCase();

            if (cleanUser === cleanAns) {
                document.getElementById('activeCell').style.background = "#2ecc71";
                document.getElementById('activeCell').style.color = "white";
                document.getElementById('activeCell').innerText = lvl.res;
                setTimeout(() => { currentLvl++; loadLevel(); }, 1200);
            } else {
                document.getElementById('activeCell').style.background = "#e74c3c";
                document.getElementById('activeCell').style.color = "white";
                setTimeout(() => {
                    document.getElementById('activeCell').style.background = "var(--excel-light)";
                    document.getElementById('activeCell').style.color = "var(--excel-green)";
                    clearInput();
                }, 600);
            }
        }

        function finishGame() {
            document.getElementById('resultOverlay').style.display = 'flex';
            
            // á•áŸ’á‰á¾á‘á·á“áŸ’á“á“áŸá™á‘áŸ… Google Form
            const formData = new FormData();
            formData.append(ID_NAME, playerName);
            formData.append(ID_SCORE, "Passed (100%)");

            fetch(FORM_URL, {
                method: "POST",
                mode: "no-cors",
                body: formData
            }).then(() => {
                document.getElementById('submittingText').innerText = "á‘á·á“áŸ’á“á“áŸá™ááŸ’ášá¼áœá”á¶á“ášá€áŸ’áŸá¶á‘á»á€á€áŸ’á“á»á„ Google Sheet ášá½á…ášá¶á›áŸ‹! âœ…";
                document.getElementById('submittingText').style.color = "#2ecc71";
            }).catch(() => {
                document.getElementById('submittingText').innerText = "á˜á¶á“á”á‰áŸ’á á¶á¢áŸŠá¸á“á’áºáá·á! áŸá¼á˜ Screenshot á•áŸ’á‰á¾á±áŸ’á™á˜áŸáŸ”";
            });
        }
    </script>
</body>
</html>
